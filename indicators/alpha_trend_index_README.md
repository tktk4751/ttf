# アルファトレンドインデックス (Alpha Trend Index)

## 概要

アルファトレンドインデックスは、BERLIN Range Indexとアルファチョピネス指標の概念を組み合わせた高度なトレンド/レンジ検出インジケーターです。このインジケーターは、市場状態（トレンド相場とレンジ相場）を識別し、効率的な取引戦略の構築を支援します。

主な特徴：

1. **効率比（ER）に基づく動的適応**：市場の効率性に応じて、チョピネス期間、ATR期間、標準偏差期間、ルックバック期間などの重要パラメータを自動調整します。
2. **SMAベースの計算**：単純移動平均（SMA）を使用して内部計算を行います。
3. **正規化された出力**：0〜1の範囲で、市場状態を直感的に解釈できます（1に近いほど強いトレンド、0に近いほど強いレンジ相場）。
4. **複数の市場状態指標の統合**：チョピネス指数、ATRの標準偏差、効率比を組み合わせて、より正確な市場状態の分類を実現します。

## 主要パラメータ

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| er_period | 21 | 効率比（ER）の計算期間 |
| max_chop_period | 21 | チョピネス期間の最大値 |
| min_chop_period | 8 | チョピネス期間の最小値 |
| max_atr_period | 21 | ATR期間の最大値 |
| min_atr_period | 10 | ATR期間の最小値 |
| max_stddev_period | 21 | 標準偏差期間の最大値 |
| min_stddev_period | 14 | 標準偏差期間の最小値 |
| max_lookback_period | 14 | 標準偏差の最小値を探す期間の最大値 |
| min_lookback_period | 7 | 標準偏差の最小値を探す期間の最小値 |

## SMAによる計算

アルファトレンドインデックスは内部計算にSMA（単純移動平均）を使用しています。SMAを使用することで、以下のメリットがあります：

1. **よりシャープな反応**：SMAはデータの変化により敏感に反応し、トレンドの変化をより早く検出します。
2. **シンプルな解釈**：各ポイントが等しく重み付けされるため、結果の解釈がより直感的です。
3. **履歴データの影響軽減**：古いデータの影響がウィンドウから完全に除外されるため、最新の市場状態をより正確に反映します。

主にSMAを使用している箇所：
- ATR（Average True Range）の計算
- 標準偏差係数の計算

## 固定設定

このインジケーターは以下の設定が常に有効になっています：

1. **正規化True Range (use_normalized_tr = True)**：価格スケールに依存しない一貫した結果を得るために、True Rangeは常に正規化されます。
2. **インデックス反転 (invert_index = True)**：トレンド/レンジ指標として直感的に解釈できるよう、値は常に反転されます（1に近いほど強いトレンド、0に近いほどレンジ相場）。

## 使用例

```python
import pandas as pd
from indicators import AlphaTrendIndex

# データの読み込み（例：OHLCデータ）
df = pd.read_csv('your_data.csv')

# インスタンス化
ati = AlphaTrendIndex(
    er_period=21,            # 効率比の計算期間
    max_chop_period=21,      # チョピネス期間の最大値
    min_chop_period=8        # チョピネス期間の最小値
)

# 計算
result = ati.calculate(
    df['open'].values,
    df['high'].values,
    df['low'].values,
    df['close'].values
)
trend_index = result.values

# 結果の取得
df['trend_index'] = trend_index

# 必要に応じて平滑化（例：5期間SMA）
# df['trend_index_smooth'] = df['trend_index'].rolling(5).mean()

# コンポーネントの取得
df['efficiency_ratio'] = ati.get_efficiency_ratio()
chop_period, atr_period, stddev_period = ati.get_dynamic_periods()
df['choppiness_index'] = ati.get_choppiness_index()
df['range_index'] = ati.get_range_index()
df['stddev_factor'] = ati.get_stddev_factor()

# 分析例（トレンド/レンジの識別）
df['market_state'] = 'neutral'
df.loc[df['trend_index'] >= 0.7, 'market_state'] = 'trend'
df.loc[df['trend_index'] <= 0.3, 'market_state'] = 'range'
```

## 市場状態の解釈

アルファトレンドインデックスの値は、以下のように解釈できます：

| 値の範囲 | 市場状態 | 推奨取引戦略 |
|---------|---------|-----------|
| 0.7 - 1.0 | 強いトレンド | トレンドフォロー戦略（移動平均、ブレイクアウト等） |
| 0.5 - 0.7 | 弱いトレンド | 慎重なトレンドフォロー、プルバック狙い |
| 0.3 - 0.5 | 弱いレンジ | 慎重なレンジ取引、トレンド発生の監視 |
| 0.0 - 0.3 | 強いレンジ | レンジ取引戦略（オシレーター、サポート/レジスタンス等） |

## アルファトレンドインデックスと他の指標の比較

| 指標 | 長所 | 短所 |
|-----|-----|-----|
| アルファトレンドインデックス | 動的適応、複数の指標の統合、正規化された出力 | 計算の複雑さ、多数のパラメータ |
| アルファチョピネス | シンプル、直感的 | 単一指標のみ、適応性が低い |
| ADX | 広く使用されている、シンプル | 遅行性が高い、誤検出の可能性 |
| ボリンジャーバンド | 視覚的に明確、多目的 | トレンド/レンジの明確な分類なし |

## ヒントとコツ

1. **最適なパラメータの調整**：異なる市場や時間枠に対して、最適なパラメータを見つけるためにバックテストを行いましょう。
2. **複数の時間枠での確認**：より信頼性の高いシグナルを得るために、複数の時間枠でアルファトレンドインデックスを確認することをお勧めします。
3. **補完的な指標との併用**：方向性を判断するための他の指標（例：移動平均、モメンタム指標）と組み合わせると効果的です。
4. **閾値の調整**：トレンド/レンジを判断する閾値（0.7と0.3）は、取引スタイルや市場に合わせて調整できます。
5. **必要に応じた平滑化**：ノイズを減らすために、最終的なアルファトレンドインデックス値にSMAなどの移動平均を適用することができます。 